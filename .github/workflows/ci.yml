name: CI

on: [push]

jobs:
    build-test:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v2

            - name: Setup .env
              run: cp .env.example .env

            - name: Replace placeholders with GitHub Secrets
              run: |
                sed -i "s/BLUEM_SENDER_ID=S/BLUEM_SENDER_ID=${{ secrets.BLUEM_SENDER_ID }}/g" .env
                sed -i "s/BLUEM_TEST_ACCESS_TOKEN=/BLUEM_TEST_ACCESS_TOKEN=${{ secrets.BLUEM_TEST_ACCESS_TOKEN }}/g" .env

            - name: Run composer
              uses: php-actions/composer@v5

            - name: PHP CodeSniffer
              run: ./vendor/bin/phpcs --runtime-set ignore_warnings_on_exit 1 --standard=PSR12 --exclude=Generic.NamingConventions.UpperCaseConstantName,PSR1.Methods.CamelCapsMethodName,PSR2.Methods.MethodDeclaration ./src

            - name: PHPUnit Tests
              uses: php-actions/phpunit@v3
              with:
                  version: 10.0
                  php_version: 8.1
                  bootstrap: ./vendor/autoload.php
                  configuration: ./.github/workflows/phpunit.xml
